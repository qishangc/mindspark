<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindSpark Lite</title>
    <meta name="description" content="MindSpark - 和自己的想法重逢。一个简洁的 AI 辅助想法管理工具。">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Quicksand:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="mindspark_lite.css">
</head>

<body>
    <div class="container">
        <!-- Sticky Header -->
        <div class="sticky-header">
            <header>
                <div style="display:flex; align-items:center; gap:12px;">
                    <div>
                        <h1>MindSpark</h1>
                        <div class="subtitle">和自己的想法重逢</div>
                    </div>
                </div>
                <div style="display:flex; gap:8px;">
                    <button onclick="openSettings()" id="settingsBtn" title="设置">⚙️</button>
                    <button onclick="toggleTheme()" id="themeBtn" title="切换主题">🌙</button>
                </div>
            </header>

            <!-- Trigger Bar -->
            <div class="input-trigger" onclick="openNoteModal()" id="note-input-area">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 20h9"></path>
                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                </svg>
                <span style="font-size: 15px;">写点什么... (Ctrl + N)</span>
            </div>

            <div class="controls">
                <input type="text" id="searchInput" placeholder="搜索想法..." 
            style="max-width: 200px; margin-bottom:0;">
                <div style="display:flex; gap:8px;">
                    <button onclick="setSort('time')" id="sortTimeBtn" style="color:var(--accent)">时间</button>
                    <button onclick="setSort('random')" id="sortRandomBtn">随机</button>
                </div>
            </div>
        </div>

        <div id="noteList" class="note-list"></div>
        <div id="emptyState" class="empty-state" style="display:none">
            <div class="empty-icon">💡</div>
            <div class="empty-title">还没有任何想法</div>
            <div class="empty-desc">点击上方的输入框，写下你的第一个灵感吧</div>
        </div>

        <!-- Load More Button -->
        <div  id ="loadMoreContainer" style="text-align: center; margin-top:20px;">
            <button id="loadMoreBtn" class="secondary-btn" style="display:none;" onclick="loadMoreNotes()">加载更多</button>
        </div>

        <!-- Note Stats Footer -->
        <div id="noteStats" class="note-stats"></div>
    </div>

    <!-- Note Create Modal -->
    <div id="noteModal" class="modal-overlay" onclick="closeNoteModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">新想法</h3>
                <button onclick="closeNoteModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <textarea id="noteInput" class="modal-textarea" placeholder="写点什么..."></textarea>

            <div style="display: flex; justify-content: flex-end; gap: 12px; align-items: center;">
                <span id="charCount" style="font-size: 13px; color: var(--text-secondary);">0 字</span>
                <button class="primary-btn" onclick="saveNote()" id="saveBtn">
                    保存 (Ctrl+Enter)
                </button>
            </div>
        </div>
    </div>

    <!-- Note Detail Modal -->
    <div id="detailModal" class="modal-overlay" onclick="closeDetailModal()">
        <div class="modal-box detail-modal-box" onclick="event.stopPropagation()">
            <!-- Detail Header -->
            <div class="detail-header">
                <div id="detailTime" class="detail-time"></div>
                <div class="detail-actions">
                    <!-- Normal Mode Actions -->
                    <div id="detailNormalActions">
                        <div id="deleteConfirmGroup" style="display:none;">
                            <span style="font-size:14px; color:var(--danger);">确认删除？</span>
                            <button onclick="executeDeleteNote()" class="danger-small-btn">是</button>
                            <button onclick="cancelDeleteNote()" class="secondary-small-btn">否</button>
                        </div>
                        <button id="deleteBtn" onclick="confirmDeleteNote()" title="删除" class="icon-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                </path>
                            </svg>
                        </button>
                        <button onclick="startEditNote()" title="编辑" class="icon-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                    </div>
                    <!-- Edit Mode Actions -->
                    <div id="detailEditActions" style="display:none;">
                        <button onclick="cancelEditNote()" class="secondary-btn" style="font-size:14px;">取消</button>
                        <button onclick="saveEditNote()" class="primary-btn" id="editSaveBtn"
                            style="font-size:14px; padding:6px 16px;">完成</button>
                    </div>
                    <button onclick="closeDetailModal()" title="关闭" class="icon-btn" style="margin-left:12px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Detail Content -->
            <div class="detail-content">
                <div id="detailViewContent" class="detail-view-content"></div>
                <textarea id="detailEditContent" class="detail-edit-textarea" style="display:none;"></textarea>

                <!-- Related Notes Section -->
                <div id="detailRelated" class="detail-related">
                    <h4 class="detail-related-title">✨ 相关想法</h4>
                    <div id="detailRelatedList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay" onclick="closeSettings()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">设置</h3>
                <button onclick="closeSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">AI 提供商</label>
                <div style="font-size:13px; color:var(--text-secondary); margin-bottom:12px;">
                    选择预设或自定义 API 配置。新笔记会自动嵌入向量。
                </div>

                <label class="form-label">选择供应商</label>
                <select id="providerSelect" onchange="onProviderChange()" class="form-select">
                    <option value="custom">自定义</option>
                    <option value="openai">OpenAI</option>
                    <option value="gemini">Google Gemini</option>
                    <option value="deepseek">DeepSeek</option>
                    <option value="siliconflow">SiliconFlow (硅基流动)</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">API Base URL</label>
                <input type="text" id="apiBaseUrl" placeholder="https://api.openai.com/v1"
                    value="https://api.openai.com/v1">
            </div>

            <div class="form-group">
                <label class="form-label">API Key</label>
                <input type="password" id="apiKey" placeholder="sk-...">
            </div>

            <div class="form-group">
                <label class="form-label">Embedding Model</label>
                <input type="text" id="apiModel" placeholder="text-embedding-3-small" value="text-embedding-3-small">
            </div>

            <div style="display:flex; justify-content:flex-end; gap:8px;">
                <button class="secondary-btn" onclick="closeSettings()">取消</button>
                <button class="secondary-btn" onclick="testApiConnection()">测试连接</button>
                <button class="primary-btn" onclick="saveSettings()">保存配置</button>
            </div>

            <hr class="divider">

            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <span style="font-size:14px; font-weight:600;">数据备份与恢复</span>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                    <button class="secondary-btn" onclick="exportData()">导出 JSON</button>
                    <button class="secondary-btn" onclick="exportMarkdown()">导出 MD</button>
                    <button class="secondary-btn" onclick="document.getElementById('importFile').click()">导入
                        JSON</button>
                    <button class="secondary-btn" onclick="document.getElementById('importMdFile').click()">导入
                        MD</button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                    <input type="file" id="importMdFile" accept=".md,.markdown,.txt" style="display:none" multiple
                        onchange="importMdFiles(event)">
                </div>
            </div>

            <hr class="divider">

            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:14px; font-weight:600;">处理旧笔记向量</span>
                <button class="secondary-btn" onclick="processAllNotes()" id="processBtn">开始处理</button>
            </div>
            <div id="processStatus" style="font-size:12px; color:var(--text-secondary); margin-top:8px;"></div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboardingModal" class="modal-overlay">
        <div class="onboarding-backdrop" onclick="skipOnboarding()"></div>
        <div class="onboarding-card">
            <button onclick="skipOnboarding()" class="onboarding-close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h3 id="onboardingTitle" class="onboarding-title"></h3>
            <p id="onboardingContent" class="onboarding-content"></p>
            <div class="onboarding-footer">
                <div id="onboardingDots" class="onboarding-dots"></div>
                <button id="onboardingNextBtn" onclick="nextOnboardingStep()" class="primary-btn"
                    style="padding:8px 18px; font-size:14px;"></button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="script.js"></script>
</body>

</html>
